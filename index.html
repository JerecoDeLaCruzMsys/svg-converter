<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Upload SVG to Text/JSON</title>
</head>
<body>
  <h2>Upload an SVG file</h2>
  <form id="svg-upload-form">
    <input type="file" id="svg-file-input" accept=".svg" required />
    <label>
      <input type="checkbox" id="as-json" />
      Get as JSON
    </label>
    <button type="submit">Upload</button>
  </form>

  <button id="download-btn" style="margin-top: 10px; display:none;">Download Result (.txt)</button>

  <h3>SVG Content:</h3>
  <pre id="result" style="white-space: pre-wrap; word-break: break-word;"></pre>

  <script>
    document.getElementById('svg-upload-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const fileInput = document.getElementById('svg-file-input');
      if (!fileInput.files.length) {
        alert('Please choose an SVG file!');
        return;
      }
      const asJson = document.getElementById('as-json').checked;
      const formData = new FormData();
      formData.append('svg', fileInput.files[0]);
      const url = 'https://svg-converter-weld.vercel.app/api/upload' + (asJson ? '?format=json' : '');
      try {
        const response = await fetch(url, {
          method: 'POST',
          body: formData
        });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        let resultText = "";
        if (asJson) {
          const data = await response.json();
          resultText = JSON.stringify(data, null, 2);
        } else {
          resultText = await response.text();
        }
        document.getElementById('result').textContent = resultText;

        // Show download button
        document.getElementById('download-btn').style.display = "inline-block";

      } catch (err) {
        document.getElementById('result').textContent = 'Error: ' + err;
      }
    });

    // Download result as .txt file
    document.getElementById('download-btn').addEventListener('click', function () {
      const text = document.getElementById('result').textContent;
      const blob = new Blob([text], { type: "text/plain" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = "svg_output.txt";
      a.click();

      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
